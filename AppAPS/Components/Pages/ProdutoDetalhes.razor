@page "/produtoDetalhes/{Id}"
@rendermode RenderMode.InteractiveServer

<style>
    .fluent-label {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .fluent-label-nome {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 1;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>

<PageTitle>Página inicial</PageTitle>


<FluentStack Style="display: flex; align-items: center; justify-content: center">
    <FluentCard Width="80%" Height="90%">
        @{
            if (Produto is not null)
            {
                <FluentStack>
                    <FluentStack>
                        <FluentCard Style="padding: 0;" Width="100%" Height="100%">
                            <img src="@Produto.NomeArquivoUpload" style="object-fit: cover; height: 70vh; width: 100%" />
                        </FluentCard>
                    </FluentStack>
                    <FluentStack Style="display: flex; flex-direction: column; padding: 10px">
                        <FluentStack HorizontalAlignment="HorizontalAlignment.Center">
                            <FluentLabel Typo="Typography.H1">@Produto.Nome</FluentLabel>
                            </FluentStack>
                            <FluentStack Style="display: flex; flex-direction: column">
                                <FluentLabel Style="font-size: 25px" Typo="Typography.Subject">@Produto.Descricao</FluentLabel>
                                @* Precisa ser substituída pela listagem de ingredientes da ficha *@
                                <Produtos />
                            </FluentStack>
                            <FluentDivider />

                        </FluentStack>
                    </FluentStack>
            }
            else
            {
                <FluentLabel Typo="Typography.H2">Produto não encontrado.</FluentLabel>
            }
        }
    </FluentCard>
</FluentStack>


<TrocaVisualizacao PrimeiraDefinicao="false" bDesabilitaDialogTrocaVisu="@bDesabilitaDialogTrocaVisu" />

<FluentStack Style="position: fixed; bottom: 20px; left: 10px;" Width="20%">
    <FluentButton BackgroundColor="purple" Color="white" OnClick="() => bDesabilitaDialogTrocaVisu = false">Altera Modo Visualização</FluentButton>
</FluentStack>

@code {
    [Parameter] public string Id { get; set; }
    [Inject] private IProdutoService ProdutoService { get; set; }
    [Inject] private SessaoUsuario sessaoUsuario { get; set; }
    [Inject] private IMapper mapper { get; set; }
    private List<EnumItem<TipoUsuario>> TiposUsuario = new List<EnumItem<TipoUsuario>>();
    public Produto? Produto;
    public decimal Numero { get; set; }
    public int IdProduto { get; set; }
    public bool bDesabilitaDialogTrocaVisu { get; set; } = true;

    protected async override Task OnInitializedAsync()
    {
        TiposUsuario = EnumHelper.GetEnumItems<TipoUsuario>();
        IdProduto = Convert.ToInt32(Id);
        Produto = await ProdutoService.GetByIdProduto(IdProduto);
    }

    private void OnTipoUsuarioChanged(string selectedValue)
    {
        sessaoUsuario.TipoUsuario = TiposUsuario.FirstOrDefault(item => item.Description == selectedValue)?.Value ?? sessaoUsuario.TipoUsuario;
    }
}
