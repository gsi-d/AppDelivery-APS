@page "/"
@using AppAPS.DTOs
@using AppAPS.Entities
@using AppAPS.Interfaces
@using AutoMapper
@rendermode RenderMode.InteractiveServer

<style>
    .fluent-label {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .fluent-label-nome {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 1;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>

<PageTitle>Página inicial</PageTitle>


<FluentStack Style="display: flex; flex-wrap: wrap; gap: 20px;">
    @{
        foreach (ProdutoItemDTO produtoItem in produtosItem)
        {
            <FluentCard Width="30%" Height="50%">
                <FluentCard Style="padding: 0;" Width="100%" Height="60%">
                    <img src="@produtoItem.NomeArquivoUpload" style="object-fit: cover; height: 30vh; width: 100%" />
                </FluentCard>
                <FluentLabel Typo="Typography.H2" Class="fluent-label-nome">@produtoItem.Nome</FluentLabel>
                    <FluentLabel Typo="Typography.Body" Class="fluent-label">@produtoItem.Descricao</FluentLabel>
                    <FluentStack Style="padding-top: 10px" VerticalAlignment="VerticalAlignment.Bottom">
                        <FluentButton IconStart="@(new Icons.Regular.Size20.AppsListDetail())" Appearance="Appearance.Accent" OnClick="async () => await InvokeDetalhes(produtoItem.Id)" BackgroundColor="purple">Detalhes</FluentButton>
                        <FluentStack HorizontalAlignment="HorizontalAlignment.Right">
                            <FluentLabel Typo="Typography.H5" Style="margin-top: 3px">Qtd:</FluentLabel>
                            <FluentNumberField @bind-Value="@produtoItem.Quantidade" Size="1" Min="0"></FluentNumberField>
                            <FluentButton IconStart="@(new Icons.Regular.Size20.Cart())" Appearance="Appearance.Accent">
                            </FluentButton>
                        </FluentStack>
                    </FluentStack>
                </FluentCard>
        }
    }
</FluentStack>

<FluentButton IconStart="@(new Icons.Regular.Size20.Cart())"
              Appearance="Appearance.Accent"
              BackgroundColor="green"
              style="position: fixed; bottom: 20px; right: 20px;">
    Finalizar pedido
</FluentButton>

@code {
    [Inject] private IProdutoService produtoService { get; set; }
    [Inject] private IMapper mapper { get; set; }
    public List<Produto>? produtos;
    public IQueryable<ProdutoItemDTO>? produtosItem;
    public decimal Numero { get; set; }

    protected override Task OnInitializedAsync()
    {
        produtos = produtoService.GetAllProdutos();
        var produtosMapeados = mapper.Map<List<ProdutoItemDTO>>(produtos);
        produtosItem = produtosMapeados.AsQueryable();
        return Task.CompletedTask;
    }

    private async Task InvokeDetalhes(int id)
    {
        _navigationManager.NavigateTo($"/detalhes/{id}");
    }
}
